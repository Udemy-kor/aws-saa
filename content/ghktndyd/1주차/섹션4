## IAM

- IAM: Identity and Access Management의 약자

- 루트 계정은 계정 생성 당시에만 사용해야 한다.

- 그룹 별로 나눠서 권한 관리를 해야 한다.

- 한 사용자는 여러 그룹에 속할 수 있으며, 그룹에는 그룹을 포함할 수 없다.

- IAM의 권한 정책은 JSON 문서로 정의할 수 있다.

- AWS에서는 최소 권한의 원칙을 준수하며 관리해야 한다. (필요한 권한만 주자)

- IAM은 글로벌 서비스 (리전 필요 X)

### IAM 정책

- IAM 정책은 그룹 단위로 설정 가능하고, 개인 단위로도 설정 가능하다. 개인 단위 설정을 인라인 설정이라고 한다.
- AWS에서는 Json 문서 형태로 정의한다.
	- IAM 정책 구조 요소는 정책 버전을 포함한다.
	- 정책 식별 ID도 존재하지만 선택사항이다.
	- **effect**: 특정 API에서 접근하는 것을 허용할지 안 할지를 선택한다.
	- **principal**: 특정 정책이 적용될 사용자, 계정, 혹은 역할로 정의된다.
	- **action**: effect 기반으로 허용 및 거부 될 api의 목록이다.
	- **resource**: 적용될 action의 목록이다.
	- condition: 언제 정책이 실행될지 정의한다.

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "*",
            "Resource": "*"
        }
    ]
}

%%AWS에서 "`*`" 은 모든 것을 의미%%
%%위 권한은 모든 것을 허용한다는 의미다.%%
```

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "iam:GenerateCredentialReport",
                "iam:GenerateServiceLastAccessedDetails",
                "iam:Get*",
                "iam:List*",
                "iam:SimulateCustomPolicy",
                "iam:SimulatePrincipalPolicy"
            ],
            "Resource": "*"
        }
    ]
}
%%`Get *`: Get Api들은 모두 허용%%
```

### IAM 방어 정책

- IAM을 방어하는 첫번째 방법은 비밀번호 설정이 있다.
- IAM 권한 유저들이 비밀번호를 변경 가능하거나 불가능하게 설정 가능하고, 비밀번호의 변경 주기, 혹은 재사용 가능 여부도 설정 가능하다.

- IAM을 방어하는 두번째 MFA다.
- MFA는 Multi Factor Authentication이다. 다중 인증
- AWS에서는 필수이며 사용이 매우 권장된다.
- MFA는 알고 있는 비밀번호와 보유한 장치를 같이 써서 보안을 강화한다.
- 이점은 비밀번호를 도난 당하거나 잃어버려도 해커가 나의 물리적 장치를 소유하지 않으면 무용지물이란 것이다.
- MFA 장치
	- 1. **가상 MFA 장치** (여러 유저 소유 가능)
	- 2. 유니버셜 세컨드 팩터 (여러 유저 가능)
	- 3. 하드웨어 보안 토큰

### Access Keys
- SDK나 CLI를 써야 한다면 액세스 키를 발급 받아야 함
- CLI = Command Line Interface
- CLI를 쓰면 AWS 서비스에 바로 접근 가능하고, 스크립트로 일부 작업을 자동화 가능
- 때문에 관리 콘솔을 대신하여 사용하기도 한다.

### 클라우드쉘
- 서울 리전에서는 사용 불가능, 사용하려면 도쿄에서 하자
- 안 써도 그만

### IAM Roles (역할)
- AWS 서비스들 중 몇 가지는 우리 계정에서 실행해야 한다.
- 마찬가지로 어떤 권한이 필요하다. 이 권한을 위해서 IAM Role이 필요하다.
- 이것은 사람이 사용하도록 만든 게 아니고 AWS 서비스에 의해서 사용되도록 만들어졌다.
- 예를 들어서 EC2 인스턴스에서 어떤 작업을 실행하기 위해서는 **권한**이 필요한데, 이때 **이 권한이 IAM Role**이다.

### IAM 정책 보안 보고서
- 계정에 대한 정보를 확인 가능
- 비밀번호를 안 바꿨거나, 사용하지 않는 계정을 찾아내는데에 매우 유용
- Access Management 에서는 내 사용자들이 AWS의 어느 서비스에 접근했는지 알 수 있다.

### IAM 모범 사례
- 루트 계정 사용하지 않기
- AWS 유저 = 실제 사람 1명
- 보안이 그룹 수준에서 유지되도록 하자
- MFA 사용하기
- AWS 서비스에 권한을 부여할 땐 IAM Role을 사용하자
- 액세스 키는 개인만 알자
- Credential Report로 사용하지 않는 계정이나 보안이 취약한 계정을 관리하자

```
IAM 정책은 시드, 효과, 원칙, 조치, 리소스, 조건으로 구성된다.
버전은 IAM 정책 자체의 일부이고, 문장의 일부가 아니다.
```