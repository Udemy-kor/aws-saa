## IAM 소개 : 사용자, 그룹 정책

- 루트 계정은 기본적으로 생성됩니다.
- 루트 계정을 사용하지 말고 사용자 계정을 사용해야 합니다.
- 그룹을 생성하여 사용자들을 그룹에 배치해야 합니다.
- 그룹에는 오직 사용자만 배치할 수 있습니다.
- 그룹에 속하지 않은 사용자도 있을 수 있습니다.
- JSON 문서를 통해 사용자 또는 그룹에 AWS 서비스의 권한 정책을 설정할 수 있습니다.
- AWS는 최소 권한의 원칙을 적용합니다. 즉, 꼭 필요한 것 이상의 권한을 부여하지 않습니다.
- IAM은 글로벌 서비스이므로 리전 선택이 불가능합니다.
- 보안상의 이유로 루트 계정 대신 사용자 계정을 생성하여 사용하는 것이 좋습니다.

## IAM 정책
- 정책 구조
    - Version: 보통은 2012-10-17로 정책 언어 버전이 설정됩니다.
    - Id: 정책을 식별하는 ID (옵션)
    - Statement:
        - 하나 이상의 문장이 포함될 수 있습니다.
        - Sid: 문장의 식별자 (옵션)
        - Effect: 특정 API에 대해 Allow 또는 Deny를 설정합니다.
        - Principal: 정책이 적용될 사용자, 계정 또는 역할을 정의합니다.
        - Action: Effect에 기반하여 Allow 또는 Deny될 API를 설정합니다.
        - Resource: Action이 적용될 리소스 목록을 정의합니다.
        - Condition: Statement가 언제 적용될지를 결정하는 조건 (옵션)
    - *의 의미: AWS에서 *은 모든 것을 의미합니다.
        - Action: * = 모든 액션을 허용합니다.
        - Resource: * = 모든 리소스에 대해 허용합니다.

## IAM - 비밀번호 정책
- 강력한 비밀번호
    - 최소 비밀번호 길이 설정
    - 대문자, 소문자, 숫자, 특수문자 포함 요구
- 비밀번호를 직접 변경할 수 있는지 여부 설정 가능
- 일정 기간마다 비밀번호 변경 (비밀번호 유효 기간 설정)
- 이전에 사용한 비밀번호나 이미 가지고 있는 비밀번호 사용 방지

## MFA
- MFA는 비밀번호와 보안 장치의 조합입니다.
- MFA의 이점:
    - 비밀번호가 해킹당하더라도 MFA 디바이스가 별도로 존재하므로 보안이 강화됩니다.

AWS 내 MFA 종류

- Virtual MFA device
    - 가상 장치
    - Google Authenticator, Authy 등
    - 사용하기 쉬운 방법
- Universal 2nd Factor (U2F) Security
    - YubiKey by Yubico
    - 물리적 장치
    - 단일 보안 키를 사용하여 여러 루트 및 IAM 사용자를 지원합니다.
- Hardware Key Fob MFA Device
    - Gemalto에서 제공
- Hardware Key Fob MFA Device for AWS GovCloud (US)
    - SurePAssID에서 제공

# AWS 액세스 키, CLI 및 SDK
- AWS에 액세스하는 방법은 세 가지입니다.
    - AWS Management Console: 비밀번호 + MFA로 보호됨
    - AWS Command Line Interface (CLI): 액세스 키로 보호됨
    - AWS Software Development Kit (SDK): 코드에서 액세스, 액세스 키로 보호됨
- AWS 콘솔에서 액세스 키를 생성할 수 있습니다.
- 액세스 키는 비밀번호와 같아서 공유하면 안 됩니다.
    - Access Key ID는 마치 사용자 이름과 같습니다.
    - Secret Access Key는 마치 비밀번호와 같습니다.

# AWS CLI란?
- 명령줄 쉘에서 명령어를 사용하여 AWS 서비스와 상호작용할 수 있게 해주는 도구입니다.

# AWS SDK란?
- AWS Software Development Kit의 약자
- 특정 언어로 작성된 라이브러리 모음입니다.
- AWS 서비스를 프로그래밍 방식으로 접근하고 관리할 수 있습니다.

# AWS Cloud Shell
- AWS에서 무료로 사용할 수 있는 쉘입니다.
- 장점:
    - 자격 증명이 클라우드 쉘에서 실행됩니다.
- 기본 리전은 로그인한 리전으로 설정됩니다.
- CloudShell에서 작성한 파일은 다시 실행해도 저장됩니다.
- 파일 업로드 및 다운로드가 가능합니다.
- 폰트 크기 변경이 가능합니다.
- 새로운 탭을 생성할 수 있습니다.

# AWS 서비스에 대한 IAM Role
- AWS 서비스에 권한을 부여해야 하며, 이를 위해 IAM Role을 부여합니다.
- 예시: EC2 인스턴스를 생성한 후, EC2 인스턴스가 AWS에 있는 다른 리소스에 접근하려 할 때 IAM Role을 사용하여 권한을 부여합니다.

# IAM 보안 도구
- IAM Credentials Report (계정 수준)
    - 계정 내 사용자와 자격 증명 상태를 포함한 보고서입니다.
- IAM Access Advisor (사용자 수준)
    - 사용자에게 부여된 서비스의 권한과 해당 서비스에 마지막으로 액세스한 시간을 확인할 수 있습니다.

이 도구들을 사용하여 사용되지 않는 권한을 찾아 불필요한 권한을 줄이고 최소 권한의 원칙을 적용할 수 있습니다.

# IAM 모범 사례

- AWS 계정을 설정할 때를 제외하고는 루트 계정을 사용하지 않습니다.
- 한 명의 AWS 사용자는 한 명의 물리적 사용자와 매핑됩니다.
- 사용자는 그룹에 할당하고, 그룹에 권한을 할당하여 보안을 그룹 수준에서 관리합니다.
- 강력한 비밀번호를 사용합니다.
- 다중 인증(MFA)을 사용합니다.
- AWS 서비스에 권한을 부여할 때는 Roles를 생성하여 부여하는 것이 좋습니다.
- 프로그래밍 액세스 방식을 사용할 때는 액세스 키를 사용합니다. (CLI/SDK)
- 계정의 권한을 감시하려면 IAM 자격 증명서 또는 IAM 액세스 관리자 기능을 사용할 수 있습니다.
- **IAM 사용자와 액세스 키는 절대로 공유하지 않습니다.**

# IAM 요약

- Users: 한 명의 물리적 사용자와 매핑됩니다. AWS Console을 위한 비밀번호를 가집니다.
- Groups: 사용자만 포함됩니다.
- Policies: 사용자 또는 그룹에 대한 권한을 정의하는 정책 또는 JSON 문서를 첨부할 수 있습니다. 역할도 만들 수 있습니다.
- Roles: AWS 서비스에 대한 권한을 부여합니다.
- Security: MFA + 비밀번호 정책
- AWS CLI: 커맨드 라인에서 AWS 서비스를 관리합니다.
- AWS SDK: 프로그래밍 언어로 AWS 서비스를 관리합니다.
- Access Keys: CLI 또는 SDK를 통해 AWS 서비스에 액세스할 수 있는 액세스 키를 생성할 수 있습니다.
- Audit: IAM 사용량을 감사할 수 있습니다. IAM 자격 증명 보고서 및 IAM Access Advisor를 사용할 수 있습니다.